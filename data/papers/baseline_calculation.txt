=== Baseline and ΔF/F Calculation ===

Baseline Estimation:
Method 1: Percentile-based
baseline = np.percentile(trace, 10)
Rationale: 10th percentile captures low-activity periods
Works well when cells are quiescent most of the time.

Method 2: Rolling minimum
baseline = scipy.ndimage.minimum_filter1d(trace, size=window)
Typical window: 100-200 frames
This adapts to slow baseline drift over time.

Method 3: Mode-based estimation
For noisy data, estimate baseline as the mode of the distribution.
Use histogram to find most common fluorescence value.
Implementation: np.histogram followed by finding bin with max count.

ΔF/F Calculation:
Formula: dff = (trace - baseline) / baseline
Where F = fluorescence trace, baseline = F0
This normalizes signal across cells with different expression levels.

Interpretation:
ΔF/F represents fractional change in fluorescence
Values typically range 0.1-3.0 for calcium transients
Larger values indicate stronger calcium influx
Negative values may indicate photobleaching or measurement noise.

Robust ΔF/F:
For noisy data, use median instead of mean for baseline.
Clip negative ΔF/F values to zero (physiologically more accurate).
Implementation: dff = np.maximum((trace - baseline) / baseline, 0)

Mean Intensity Calculation:
For spatial analysis, calculate mean intensity per frame.
Simply use np.mean(images, axis=(1, 2)) for time series of mean intensity.
For ROI-based analysis, use labeled_image as mask.
Extract intensities: [images[:, roi_mask].mean(axis=1) for each ROI]

Photobleaching Correction:
If baseline drifts down over time, apply exponential fit correction.
Fit exponential to baseline: baseline_fit = A * np.exp(-t/tau) + C
Divide raw trace by fitted baseline before calculating ΔF/F.
